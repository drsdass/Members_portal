{% extends "base.html" %}

{% block title %}Dashboard - {{ selected_entity }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">{{ session['report_type']|replace('_', ' ')|title }} for {{ selected_entity }}</h2>

    {# Conditional display for Financials Report #}
    {% if report_type == 'financials' %}
        <p class="lead">This is the Financials Report for <strong>{{ selected_entity }}</strong>.</p>
        {% if files %}
            <h3 class="mt-4">Available Financial Reports:</h3>
            <div class="list-group">
                {% for year, reports in files.items() %}
                    <h4 class="mt-3">Reports for Year {{ year }}:</h4>
                    <ul class="list-unstyled">
                        {% for report in reports %}
                            <li>
                                <a href="{{ report.webViewLink }}" target="_blank" class="btn btn-info btn-sm mb-1">
                                    View {{ report.name }}
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                {% endfor %}
            </div>
        {% else %}
            <p class="alert alert-info">No financial reports available for this entity or period.</p>
        {% endif %}
        {# Display data table if data exists for financials #}
        {% if data %}
            <h3 class="mt-4">Data Overview:</h3>
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-hover">
                    <thead class="thead-dark">
                        <tr>
                            {% for col in data[0].keys() %}
                                <th>{{ col }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in data %}
                            <tr>
                                {% for val in row.values() %}
                                    <td>{{ val }}</td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}

    {# Conditional display for Marketing Material Report #}
    {% elif report_type == 'marketing_material' %}
        <p class="lead">Here are the marketing materials for <strong>{{ selected_entity }}</strong>.</p>
        {% if files %}
            <h3 class="mt-4">Available Marketing Materials:</h3>
            <div class="list-group">
                {# The outer loop 'entity_name' will be the selected_entity if only one is passed #}
                {# Or it will iterate through all entities if no specific one was selected (fallback) #}
                {% for entity_name, reports in files.items() %}
                    {% if selected_entity and entity_name == selected_entity %}
                        <ul class="list-unstyled">
                            {% for report in reports %}
                                <li>
                                    <a href="{{ report.webViewLink }}" target="_blank" class="btn btn-primary btn-sm mb-1">
                                        View {{ report.name }}
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% elif not selected_entity %} {# This block handles the fallback where all entities' marketing is shown #}
                         <h4 class="mt-3">{{ entity_name }} Marketing:</h4>
                         <ul class="list-unstyled">
                            {% for report in reports %}
                                <li>
                                    <a href="{{ report.webViewLink }}" target="_blank" class="btn btn-primary btn-sm mb-1">
                                        View {{ report.name }}
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                {% endfor %}
            </div>
        {% else %}
            <p class="alert alert-info">No marketing materials available for this entity.</p>
        {% endif %}

    {# Conditional display for Monthly Bonus Report #}
    {% elif report_type == 'monthly_bonus' %}
        <p class="lead">This is the Monthly Bonus Report for <strong>{{ selected_entity }}</strong>.</p>
        <p>Month: <span class="badge badge-secondary">{{ selected_month|default('N/A') }}</span> Year: <span class="badge badge-secondary">{{ selected_year|default('N/A') }}</span></p>
        {% if data %}
            <h3 class="mt-4">Bonus Report Details:</h3>
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-hover">
                    <thead class="thead-dark">
                        <tr>
                            {% for col in data[0].keys() %}
                                <th>{{ col }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in data %}
                            <tr>
                                {% for val in row.values() %}
                                    <td>{{ val }}</td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p class="alert alert-info">No monthly bonus data available for this entity or period.</p>
        {% endif %}

    {# Generic message for other report types or default #}
    {% else %}
        <p class="alert alert-warning">No specific display for this report type yet. Report type: <strong>{{ report_type }}</strong></p>
        {% if data %}
            <h3 class="mt-4">Data Overview:</h3>
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-hover">
                    <thead class="thead-dark">
                        <tr>
                            {% for col in data[0].keys() %}
                                <th>{{ col }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in data %}
                            <tr>
                                {% for val in row.values() %}
                                    <td>{{ val }}</td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
    {% endif %}

    <div class="mt-5 p-3 bg-light border rounded">
        <p class="text-danger font-weight-bold">Important Disclaimer:</p>
        <p class="text-muted small">This information is proprietary and confidential. It is not to be shared, copied, or distributed outside of authorized personnel. This includes, but is not limited to, patient data, financial figures, and business strategies.</p>
    </div>
</div>
{% endblock %}
